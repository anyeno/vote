<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../scr/css/登录.css">
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
</head>
<body>
    <div class="login">
        <h1>Login</h1>
            <input type="text" id="uname" value="" placeholder="用户名" /><br>
            <input type="password" id="pwd" value="" placeholder="密 码" /><br>
            <div class="error_msg" style="color: blue"></div>
            <input type="submit" id="but" value="登录" />
            <!-- 返回了true就会打开页面  -->
    </div>
    <script type="text/javascript">
        let error_message = "";
        function getinfo() {
            $.ajax({
                url: "http://127.0.0.1:3000/user/getinfo",
                type: "GET",
                headers: {
                    token: window.localStorage.getItem("token")
                },
                success(resp) {
                    console.log(resp)
                    window.localStorage.setItem("username", resp.name)
                    window.localStorage.setItem("isAdmin", resp.isAdmin)
                    console.log(resp.name)
                    console.log(resp.isAdmin)
                    location.href = "index.html";

                },
                error() {
                    console.log("Error")
                }
            })
        }
        $("#but").click(function() {
            console.log("login")
            let username = $("#uname").val().toString();
            let password = $("#pwd").val().toString();
            let data = {};
            data["username"] = username; data["password"] = password;
            $.ajax({
                url: "http://127.0.0.1:3000/free/login",
                type: "POST",
                contentType: 'application/json; charset=UTF-8',
                data: JSON.stringify(data),
                success(resp) {
                    console.log(resp)
                    if(resp.message === "登陆失败") {
                        error_message = "用户名或密码错误"
                        console.log(error_message);
                        $(".error_msg").text(error_message)
                    } else {
                        window.localStorage.setItem("token", resp.data.token)
                        getinfo();
                    }
                    
                }
            })
        })
    </script>
</body>
</html>